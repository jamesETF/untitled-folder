<!-- Google Analytics + Bing (deferred from head to body for performance) -->
{% include google-analytics.html %}

<!-- UIkit main.min.js (restored â€” loaded from head for CLS fix) -->


<!-- Chat widget: iMessage for Business on iOS/iPadOS, Heymarket SMS on everything else -->
{% assign _hm_facade = false %}
{% if page.url == "/" or page.url == "/index.html" %}
  {% assign _hm_facade = true %}
{% elsif page.layout == "post" %}
  {% assign _hm_facade = true %}
{% elsif page.chicago or page.LA or page.Boston or page.atlanta or page.southampton %}
  {% unless page.url contains "contact" or page.url contains "puppies" or page.url contains "french-bulldog-puppies" %}
    {% assign _hm_facade = true %}
  {% endunless %}
{% endif %}

<style>
#heymk-facade{position:fixed;bottom:20px;right:15px;width:60px;height:60px;border-radius:50%;background:#8158ec;cursor:pointer;z-index:2147483645;display:none;align-items:center;justify-content:center;box-shadow:0 2px 12px rgba(0,0,0,.25);transition:transform .2s}
#heymk-facade:hover{transform:scale(1.1)}
#heymk-facade svg{width:28px;height:28px;fill:none;stroke:#fff;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
</style>
<div id="heymk-facade" aria-label="Chat with us" role="button" tabindex="0">
  <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
</div>
<script>
(function(){
  var btn=document.getElementById('heymk-facade');
  if(!btn)return;

  var ua=navigator.userAgent;
  var isApple=/iPhone|iPad|iPod/.test(ua)||(/Macintosh/.test(ua)&&navigator.maxTouchPoints>1);
  var imsgURL='https://bcrw.apple.com/urn:biz:aea0f1e1-d35e-4943-a9f1-141bc4d2db78';
  var isFacade={% if _hm_facade %}true{% else %}false{% endif %};
  var HM_ID='Zxty2CFLmAUkKi02CGybhrBdXT8gcUIKH_SA0tH3';

  /* --- Apple devices: show bubble, tap opens iMessage for Business --- */
  if(isApple){
    btn.style.display='flex';
    function openIM(){window.location.href=imsgURL;}
    btn.addEventListener('click',openIM);
    btn.addEventListener('keydown',function(e){if(e.key==='Enter')openIM();});
    return;
  }

  /* --- Non-Apple: Heymarket SMS widget --- */
  var loaded=false;
  function loadHeymarket(autoOpen){
    if(loaded)return;
    loaded=true;
    btn.style.opacity='.6';
    var s=document.createElement('script');
    s.src='https://widget.heymarket.com/heymk-widget.bundle.js?ref=[object Object]';
    s.onload=function(){
      try{
        HeymarketWidget.construct({CLIENT_ID:HM_ID});
        btn.style.display='none';
        if(autoOpen){var tries=0;(function o(){var w=document.getElementById('heymarket-widget');if(w){var b=w.querySelector('button');if(b){b.click();return;}}if(++tries<20)setTimeout(o,150);})();}
      }catch(e){btn.style.opacity='1';loaded=false;}
    };
    s.onerror=function(){btn.style.opacity='1';loaded=false;};
    document.head.appendChild(s);
  }

  if(isFacade){
    /* Low-intent pages: click-to-load facade (saves ~240KB until interaction) */
    btn.style.display='flex';
    btn.addEventListener('click',function(){loadHeymarket(true);});
    btn.addEventListener('keydown',function(e){if(e.key==='Enter')loadHeymarket(true);});
  }else{
    /* High-intent pages: auto-load Heymarket on page load */
    if(document.readyState==='complete'){loadHeymarket(false);}
    else{window.addEventListener('load',function(){loadHeymarket(false);});}
  }
})();
</script>
