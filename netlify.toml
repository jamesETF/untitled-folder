[build]
command = "bundle install && bundle exec jekyll build"
publish = "_site"
environment = { RUBY_VERSION = "3.2.2" }

[context.production.environment]
RUBY_VERSION = "3.2.2"

[context.deploy-preview.environment]
RUBY_VERSION = "3.2.2"

[context.branch-deploy.environment]
RUBY_VERSION = "3.2.2"

# --- Cache headers for static assets ---
[[headers]]
  for = "/assets/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/assets/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/uploads/*"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.png"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.jpg"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.jpeg"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.webp"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.woff2"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.woff"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# --- Duplicate URL canonicalization (trailing slash + case fixes) ---
# Source: GSC audit Feb 25, 2026 — all pairs confirmed via impression/click data

# Chicago — case-change rules use force=true; trailing-slash-only cannot use force
# (Netlify matches /path and /path/ as same, causing loops with force=true)
[[redirects]]
  from = "/illinois/chicago"
  to = "/illinois/chicago/"
  status = 301

[[redirects]]
  from = "/Illinois/Chicago"
  to = "/illinois/chicago/"
  status = 301
  force = true

[[redirects]]
  from = "/Illinois/Chicago/"
  to = "/illinois/chicago/"
  status = 301
  force = true

# LA — trailing slash only (no force — Netlify treats /path and /path/ as same)
[[redirects]]
  from = "/California/Los_Angeles"
  to = "/California/Los_Angeles/"
  status = 301

# Boston — lowercase wins (pos 9.4 / 319 clicks vs pos 47.3 / 12 clicks)
# Permalink updated to /massachusetts/boston/ to match winner
[[redirects]]
  from = "/massachusetts/Boston/"
  to = "/massachusetts/boston/"
  status = 301
  force = true

[[redirects]]
  from = "/massachusetts/Boston"
  to = "/massachusetts/boston/"
  status = 301
  force = true

# Raleigh — lowercase wins (pos 44.3 / 7 clicks vs negligible)
[[redirects]]
  from = "/NorthCarolina/Raleigh"
  to = "/northCarolina/raleigh"
  status = 301
  force = true

[[redirects]]
  from = "/NorthCarolina/Raleigh/"
  to = "/northCarolina/raleigh"
  status = 301
  force = true

# About — trailing slash only (no force)
[[redirects]]
  from = "/about-us"
  to = "/about-us/"
  status = 301

# Contact — trailing slash only (no force)
[[redirects]]
  from = "/contact-us"
  to = "/contact-us/"
  status = 301

# Puppy delivery — trailing slash only (no force)
[[redirects]]
  from = "/puppy-delivery"
  to = "/puppy-delivery/"
  status = 301

# Chicago puppies page — duplicate of main puppies page (10K impr but no Chicago-specific queries)
# Consolidate to main puppies page which already ranks for all the same terms
[[redirects]]
  from = "/Illinois/Chicago/french-bulldog-puppies"
  to = "/french-bulldog-puppies/"
  status = 301
  force = true

[[redirects]]
  from = "/Illinois/Chicago/french-bulldog-puppies/"
  to = "/french-bulldog-puppies/"
  status = 301
  force = true

[[redirects]]
  from = "/illinois/chicago/french-bulldog-puppies"
  to = "/french-bulldog-puppies/"
  status = 301
  force = true

[[redirects]]
  from = "/illinois/chicago/french-bulldog-puppies/"
  to = "/french-bulldog-puppies/"
  status = 301
  force = true

# Chicago contact sub-page — no-slash wins (negligible but clean)
[[redirects]]
  from = "/illinois/chicago/contact-us/"
  to = "/illinois/chicago/contact-us"
  status = 301

# --- Thin blog post redirects (GSC data: all under 200 impr, 0-1 clicks/year) ---
# Source: Session 15 analysis, cannibalization data confirmed redirect targets

# Scam post — cannibalizes homepage on branded queries, FAQ has scam section now
[[redirects]]
  from = "/4-signs-of-a-french-bulldog-scam-and-4-ways-you-can-avoid-them-ethical-frenchie"
  to = "/faq/"
  status = 301
  force = true

# Ethics/breeders post — homepage ranks 10x better for every query
[[redirects]]
  from = "/the-ethics-of-where-to-find-a-french-bulldog-puppy-for-your-family/"
  to = "/about-us/"
  status = 301
  force = true

# Also catch the redirect_from that was on the ethics post
[[redirects]]
  from = "/guides/how-to-register-a-blue-french-bulldog-with-the-akc/"
  to = "/about-us/"
  status = 301
  force = true

# Theft post — 1 click/year, pos 23-88 on all queries
[[redirects]]
  from = "/blog/french-bulldog-theft"
  to = "/faq/"
  status = 301
  force = true

# Pricing URLs that were redirect_from on the theft post — reroute to pricing blog
[[redirects]]
  from = "/cheap-french-bulldog-puppies-under-500/"
  to = "/blog/why-french-bulldogs-are-expensive-before-adoption/"
  status = 301
  force = true

[[redirects]]
  from = "/french-bulldog-price/"
  to = "/blog/why-french-bulldogs-are-expensive-before-adoption/"
  status = 301
  force = true

[[redirects]]
  from = "/french-bulldog-price-how-much-does-a-frenchie-cost/"
  to = "/blog/why-french-bulldogs-are-expensive-before-adoption/"
  status = 301
  force = true

# Ohio locations page — no relevance, send to puppies
[[redirects]]
  from = "/locations-blue-jay-ohio-french-bulldog-puppies/"
  to = "/french-bulldog-puppies/"
  status = 301
  force = true

# Health concerns post — cannibalizes health-risks blog post for same queries
[[redirects]]
  from = "/french-bulldogs-health-concerns-care-tips"
  to = "/blog/french-bulldog-health-risks-welfare-problems-behind-the-cute-face/"
  status = 301
  force = true

# Potty training — 5 impressions total, zero queries, non-original content
[[redirects]]
  from = "/potty-train-your-frenchie/"
  to = "/blog/"
  status = 301
  force = true
