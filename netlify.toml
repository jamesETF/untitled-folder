[build]
command = "bundle install && bundle exec jekyll build"
publish = "_site"
environment = { RUBY_VERSION = "3.2.2" }

[context.production.environment]
RUBY_VERSION = "3.2.2"

[context.deploy-preview.environment]
RUBY_VERSION = "3.2.2"

[context.branch-deploy.environment]
RUBY_VERSION = "3.2.2"

# --- Cache headers for static assets ---
[[headers]]
  for = "/assets/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/assets/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/uploads/*"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.png"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.jpg"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.jpeg"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.webp"
  [headers.values]
    Cache-Control = "public, max-age=2592000"

[[headers]]
  for = "/*.woff2"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.woff"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# --- Duplicate URL canonicalization (trailing slash + case fixes) ---
# Source: GSC audit Feb 25, 2026 — all pairs confirmed via impression/click data

# Chicago — case-change rules use force=true; trailing-slash-only cannot use force
# (Netlify matches /path and /path/ as same, causing loops with force=true)
[[redirects]]
  from = "/illinois/chicago"
  to = "/illinois/chicago/"
  status = 301

[[redirects]]
  from = "/Illinois/Chicago"
  to = "/illinois/chicago/"
  status = 301
  force = true

[[redirects]]
  from = "/Illinois/Chicago/"
  to = "/illinois/chicago/"
  status = 301
  force = true

# LA — trailing slash only (no force — Netlify treats /path and /path/ as same)
[[redirects]]
  from = "/California/Los_Angeles"
  to = "/California/Los_Angeles/"
  status = 301

# Boston — lowercase wins (pos 9.4 / 319 clicks vs pos 47.3 / 12 clicks)
# Permalink updated to /massachusetts/boston/ to match winner
[[redirects]]
  from = "/massachusetts/Boston/"
  to = "/massachusetts/boston/"
  status = 301
  force = true

[[redirects]]
  from = "/massachusetts/Boston"
  to = "/massachusetts/boston/"
  status = 301
  force = true

# Raleigh — lowercase wins (pos 44.3 / 7 clicks vs negligible)
[[redirects]]
  from = "/NorthCarolina/Raleigh"
  to = "/northCarolina/raleigh"
  status = 301
  force = true

[[redirects]]
  from = "/NorthCarolina/Raleigh/"
  to = "/northCarolina/raleigh"
  status = 301
  force = true

# About — trailing slash only (no force)
[[redirects]]
  from = "/about-us"
  to = "/about-us/"
  status = 301

# Contact — trailing slash only (no force)
[[redirects]]
  from = "/contact-us"
  to = "/contact-us/"
  status = 301

# Puppy delivery — trailing slash only (no force)
[[redirects]]
  from = "/puppy-delivery"
  to = "/puppy-delivery/"
  status = 301

# Chicago contact sub-page — no-slash wins (negligible but clean)
[[redirects]]
  from = "/illinois/chicago/contact-us/"
  to = "/illinois/chicago/contact-us"
  status = 301
